# Production Values Example
# Copy this file and customize for your production environment

global:
  imageRegistry: "your-registry.azurecr.io"
  imagePullSecrets:
    - name: acr-secret

backend:
  replicaCount: 3
  
  image:
    repository: airflow-health-backend
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  # Production Airflow configuration
  airflow:
    baseUrl: "https://airflow.production.company.com"
    authMethod: "token"
    apiToken: ""  # Set via secrets
  
  # Enable LLM for production
  llm:
    enabled: true
    provider: "azure_openai"
    model: "gpt-4o"
    azureOpenAI:
      endpoint: "https://company-openai.openai.azure.com/"
      apiVersion: "2024-08-01-preview"
      deploymentName: "gpt-4o-production"
  
  # Enable Slack notifications
  slack:
    enabled: true
  
  scheduledReports:
    enabled: true
    morningReportHour: 9
    morningReportMinute: 0
    eveningReportHour: 18
    eveningReportMinute: 0
    dashboardUrl: "https://airflow-health.production.company.com"
  
  # Production CORS settings
  corsOrigins:
    - "https://airflow-health.production.company.com"
    - "https://airflow.production.company.com"
  
  logLevel: "INFO"
  
  # Production resources
  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi
  
  # Enable autoscaling for production
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  # Pod placement
  nodeSelector:
    workload-type: application
  
  tolerations:
    - key: "workload-type"
      operator: "Equal"
      value: "application"
      effect: "NoSchedule"
  
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/component
                  operator: In
                  values:
                    - backend
            topologyKey: kubernetes.io/hostname

frontend:
  replicaCount: 3
  
  image:
    repository: airflow-health-frontend
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  # Production API URL (internal service)
  apiUrl: "http://airflow-health-backend:8000/api/v1"
  
  # Production Airflow URL (public)
  airflowUrl: "https://airflow.production.company.com"
  
  # Production resources
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  
  # Enable autoscaling
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 15
    targetCPUUtilizationPercentage: 70
  
  # Pod placement
  nodeSelector:
    workload-type: application
  
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/component
                  operator: In
                  values:
                    - frontend
            topologyKey: kubernetes.io/hostname

# Use external Redis in production
redis:
  enabled: true
  external:
    enabled: true
    url: "redis://redis-master.redis-system.svc.cluster.local:6379"

# Enable ingress for production
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
  
  hosts:
    - host: airflow-health.production.company.com
      paths:
        - path: /
          pathType: Prefix
          backend: frontend
        - path: /api
          pathType: Prefix
          backend: backend
  
  tls:
    - secretName: airflow-health-production-tls
      hosts:
        - airflow-health.production.company.com

# Enable network policies
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress
  egress:
    # Allow DNS resolution
    - to:
        - namespaceSelector:
            matchLabels:
              name: kube-system
      ports:
        - protocol: UDP
          port: 53
    # Allow egress to Airflow
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 8080
        - protocol: TCP
          port: 443
    # Allow egress to Redis
    - to:
        - namespaceSelector:
            matchLabels:
              name: redis-system
      ports:
        - protocol: TCP
          port: 6379

# Enable pod disruption budgets
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# Use external secret management in production
# Create secrets using your secret management tool (Sealed Secrets, External Secrets, etc.)
secrets:
  create: false
  # Secrets should be created externally and referenced here
